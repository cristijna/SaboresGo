{% extends "core/base.html" %}
{% block content %}

<section style="max-width:1200px; margin:40px auto; background:#fff; padding:30px; border-radius:10px; box-shadow:0 0 15px rgba(0,0,0,0.1);">
  <h2 style="text-align:center; color:#5b0d0d; margin-bottom:30px;">Panel de Administraci칩n</h2>

  <!-- 游늳 Tarjetas resumen -->
  <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(220px, 1fr)); gap:20px; margin-bottom:40px;">
    <div style="background:#facc15; padding:20px; border-radius:10px; text-align:center;">
      <h3 style="margin:0; font-size:2rem;">{{ total_pedidos }}</h3>
      <p>Total de Pedidos</p>
    </div>
    <div style="background:#3b82f6; color:#fff; padding:20px; border-radius:10px; text-align:center;">
      <h3 style="margin:0; font-size:2rem;">{{ pedidos_preparando }}</h3>
      <p>Preparando</p>
    </div>
    <div style="background:#f97316; color:#fff; padding:20px; border-radius:10px; text-align:center;">
      <h3 style="margin:0; font-size:2rem;">{{ pedidos_en_camino }}</h3>
      <p>En Camino</p>
    </div>
    <div style="background:#16a34a; color:#fff; padding:20px; border-radius:10px; text-align:center;">
      <h3 style="margin:0; font-size:2rem;">{{ pedidos_entregados }}</h3>
      <p>Entregados</p>
    </div>
  </div>

  <!-- 游논 Tarjetas de proveedores -->
  <div style="display:flex; gap:20px; justify-content:center; margin-bottom:40px; flex-wrap:wrap;">
    <div style="background:#5b0d0d; color:white; padding:20px; border-radius:10px; min-width:220px; text-align:center;">
      <h3 style="margin:0; font-size:2rem;">{{ total_proveedores }}</h3>
      <p>Total de Proveedores</p>
    </div>
    <div style="background:#e3c178; color:#000; padding:20px; border-radius:10px; min-width:220px; text-align:center;">
      <h3 style="margin:0; font-size:2rem;">{{ proveedores_aprobados }}</h3>
      <p>Proveedores Aprobados</p>
    </div>
  </div>

  <!-- 游늵 Gr치fico de estados -->
  <div style="max-width:600px; margin:0 auto 60px auto;">
    <canvas id="graficoEstados"></canvas>
  </div>

  <!-- 游 칔ltimos pedidos -->
  <h3 style="color:#5b0d0d; margin-bottom:15px;">칔ltimos pedidos</h3>
  <table style="width:100%; border-collapse:collapse; text-align:center;">
    <thead>
      <tr style="background:#5b0d0d; color:#fff;">
        <th style="padding:10px;">Cliente</th>
        <th>Plato</th>
        <th>Proveedor</th>
        <th>Estado</th>
        <th>Fecha</th>
      </tr>
    </thead>
    <tbody>
      {% for p in ultimos_pedidos %}
      <tr style="border-bottom:1px solid #ddd;">
        <td style="padding:10px;">{{ p.cliente }}</td>
        <td>{{ p.plato }}</td>
        <td>{{ p.proveedor.nombre }}</td>
        <td>
          {% if p.estado == 'pendiente' %}
            <span style="background:#ccc; color:#000; padding:4px 10px; border-radius:5px;">Pendiente</span>
          {% elif p.estado == 'preparando' %}
            <span style="background:#3b82f6; color:#fff; padding:4px 10px; border-radius:5px;">Preparando</span>
          {% elif p.estado == 'en_camino' %}
            <span style="background:#f97316; color:#fff; padding:4px 10px; border-radius:5px;">En camino</span>
          {% elif p.estado == 'entregado' %}
            <span style="background:#16a34a; color:#fff; padding:4px 10px; border-radius:5px;">Entregado</span>
          {% endif %}
        </td>
        <td>{{ p.fecha_pedido|date:"d/m/Y H:i" }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="5" style="padding:15px;">No hay pedidos recientes.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>


<!-- 游늵 Script del gr치fico -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const pedidosData = {
    pendientes: "{{ pedidos_pendientes|default:0 }}",
    preparando: "{{ pedidos_preparando|default:0 }}",
    en_camino: "{{ pedidos_en_camino|default:0 }}",
    entregados: "{{ pedidos_entregados|default:0 }}"
  };

  const ctx = document.getElementById("graficoEstados").getContext("2d");

  new Chart(ctx, {
    type: "doughnut",
    data: {
      labels: ["Pendiente", "Preparando", "En Camino", "Entregado"],
      datasets: [{
        label: "Pedidos",
        data: [
          pedidosData.pendientes,
          pedidosData.preparando,
          pedidosData.en_camino,
          pedidosData.entregados
        ],
        backgroundColor: ["#facc15", "#3b82f6", "#f97316", "#16a34a"],
        borderWidth: 1
      }]
    },
    options: {
      plugins: {
        legend: {
          position: "bottom",
          labels: { color: "#000" }
        }
      }
    }
  });
</script>

{% endblock %}
