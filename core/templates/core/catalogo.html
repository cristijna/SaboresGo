{% extends 'core/base.html' %}
{% load static %}
{% block title %}Cat치logo{% endblock %}

{% block content %}
<section class="catalogo">
  <header class="catalogo-header">
    <h1>Cat치logo de Proveedores y Platos</h1>
    <p class="subtitulo">
      Explora nuestra red de restaurantes y proveedores locales.  
      Elige tus platos favoritos y realiza pedidos directamente.
    </p>
  </header>

  {% for p in proveedores %}
    <section class="proveedor-card">
      <div class="proveedor-info">
        <div class="proveedor-header">
          {% if p.logo %}
            <img src="{{ p.logo.url }}" alt="{{ p.empresa }}" class="proveedor-logo">
          {% else %}
            <img src="{% static 'core/img/default-logo.png' %}" alt="Sin logo" class="proveedor-logo">
          {% endif %}
          <div>
            <h2 class="proveedor-nombre">{{ p.empresa|default:"Proveedor sin nombre" }}</h2>
            {% if p.telefono %}
              <p class="proveedor-telefono">游 {{ p.telefono }}</p>
            {% endif %}
          </div>
        </div>
        {% if p.descripcion %}
          <p class="proveedor-descripcion">{{ p.descripcion }}</p>
        {% endif %}
      </div>

      <div class="platos-grid">
        {% for plato in p.platos.all %}
          <article class="plato-card">
            <div class="plato-img-container">
              {% if plato.imagen %}
                <img src="{{ plato.imagen.url }}" alt="{{ plato.nombre }}" class="plato-img">
              {% else %}
                <img src="{% static 'core/img/default-plato.jpg' %}" alt="Sin imagen" class="plato-img">
              {% endif %}
            </div>
            <div class="plato-body">
              <h3 class="plato-nombre">{{ plato.nombre }}</h3>
              <p class="plato-descripcion">{{ plato.descripcion|default:"Sin descripci칩n disponible." }}</p>
              <p class="plato-precio"><strong>${{ plato.precio }}</strong></p>

              {% if user.is_authenticated %}
                {% if not user.proveedor_profile %}
                  <form method="post" action="{% url 'core:pedido_create' %}" class="pedido-form">
                    {% csrf_token %}
                    <input type="hidden" name="plato" value="{{ plato.id }}">
                    <input type="number" name="cantidad" value="1" min="1" class="pedido-cantidad">
                    <button type="submit" class="btn btn-primary">Pedir</button>
                  </form>
                {% endif %}
              {% else %}
                <a href="{% url 'core:login' %}" class="btn btn-outline">Inicia sesi칩n para pedir</a>
              {% endif %}
            </div>
          </article>
        {% empty %}
          <p class="sin-platos">No hay platos disponibles para este proveedor.</p>
        {% endfor %}
      </div>
    </section>
  {% empty %}
    <p class="sin-proveedores">No hay proveedores registrados a칰n.</p>
  {% endfor %}
</section>
{% endblock %}
